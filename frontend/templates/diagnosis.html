<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Complete the diagnosis form to receive your personalized skin condition analysis">
    <title>Diagnosis - Skin Disease Expert System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239D8DF1'><circle cx='12' cy='12' r='10'/></svg>">
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="/" class="nav-brand">
                <div class="nav-brand-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                </div>
                <span>SkinDx Expert</span>
            </a>
            
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>
            
            <div class="nav-links" id="navLinks">
                <a href="/" class="nav-link">Home</a>
                <a href="/diagnosis" class="nav-link active">Diagnosis</a>
                <a href="/documentation" class="nav-link">Documentation</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content diagnosis-page">
        <div class="container">
            <div class="diagnosis-header">
                <span class="section-label">Step 1 of 1</span>
                <h1 class="section-title">Complete Your Diagnosis</h1>
                <p class="section-subtitle">
                    Fill in all the information below to receive your personalized skin condition analysis
                </p>
            </div>

            <div class="diagnosis-grid">
                <form id="diagnosisForm" class="glass-card">
                    <!-- Patient Profile Section -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <h2 class="form-section-title">Patient Profile</h2>
                        </div>

                        <!-- Age Group -->
                        <div class="form-group">
                            <label class="form-label">What is your age group?</label>
                            <div class="options-group">
                                <div class="option-item">
                                    <input type="radio" name="age_group" id="age_child" value="Child" class="option-input" required>
                                    <label for="age_child" class="option-label">Child</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="age_group" id="age_adult" value="Adult" class="option-input">
                                    <label for="age_adult" class="option-label">Adult</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="age_group" id="age_elderly" value="Elderly" class="option-input">
                                    <label for="age_elderly" class="option-label">Elderly</label>
                                </div>
                            </div>
                        </div>

                        <!-- Allergy -->
                        <div class="form-group">
                            <label class="form-label">Do you have any known allergies?</label>
                            <div class="options-group">
                                <div class="option-item">
                                    <input type="radio" name="allergy" id="allergy_none" value="None" class="option-input" required>
                                    <label for="allergy_none" class="option-label">None</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="allergy" id="allergy_peanut" value="Peanut" class="option-input">
                                    <label for="allergy_peanut" class="option-label">Peanut</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="allergy" id="allergy_seafood" value="Seafood" class="option-input">
                                    <label for="allergy_seafood" class="option-label">Seafood</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Symptoms Section -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                                </svg>
                            </div>
                            <h2 class="form-section-title">Symptoms</h2>
                        </div>

                        <!-- Itching -->
                        <div class="form-group">
                            <label class="form-label">Are you experiencing itching?</label>
                            <div class="options-group">
                                <div class="option-item">
                                    <input type="radio" name="itching" id="itching_yes" value="Yes" class="option-input" required>
                                    <label for="itching_yes" class="option-label">Yes</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="itching" id="itching_no" value="No" class="option-input">
                                    <label for="itching_no" class="option-label">No</label>
                                </div>
                            </div>
                        </div>

                        <!-- Burning Sensation -->
                        <div class="form-group">
                            <label class="form-label">Are you experiencing a burning sensation?</label>
                            <div class="options-group">
                                <div class="option-item">
                                    <input type="radio" name="burning_sensation" id="burning_yes" value="Yes" class="option-input" required>
                                    <label for="burning_yes" class="option-label">Yes</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="burning_sensation" id="burning_no" value="No" class="option-input">
                                    <label for="burning_no" class="option-label">No</label>
                                </div>
                            </div>
                        </div>

                        <!-- Pain -->
                        <div class="form-group">
                            <label class="form-label">Are you experiencing pain?</label>
                            <div class="options-group">
                                <div class="option-item">
                                    <input type="radio" name="pain" id="pain_yes" value="Yes" class="option-input" required>
                                    <label for="pain_yes" class="option-label">Yes</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="pain" id="pain_no" value="No" class="option-input">
                                    <label for="pain_no" class="option-label">No</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesion Appearance Section -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4"/>
                                    <path d="M12 8h.01"/>
                                </svg>
                            </div>
                            <h2 class="form-section-title">Lesion Appearance</h2>
                        </div>

                        <!-- Appearance (Multi-select) -->
                        <div class="form-group">
                            <label class="form-label">How does the skin lesion appear? (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_circular" value="Circular" class="checkbox-input">
                                    <label for="app_circular" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Circular</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_annular" value="Annular" class="checkbox-input">
                                    <label for="app_annular" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Annular</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_scaly" value="Scaly / Flaky" class="checkbox-input">
                                    <label for="app_scaly" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Scaly / Flaky</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_demarcated" value="Well-Demarcated" class="checkbox-input">
                                    <label for="app_demarcated" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Well-Demarcated</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_swollen" value="Swollen" class="checkbox-input">
                                    <label for="app_swollen" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Swollen</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_papules" value="Papules / Pustules" class="checkbox-input">
                                    <label for="app_papules" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Papules / Pustules</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_crusting" value="Crusting / Oozing" class="checkbox-input">
                                    <label for="app_crusting" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Crusting / Oozing</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_pigmented" value="Hyperpigmented / Depigmented" class="checkbox-input">
                                    <label for="app_pigmented" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Hyperpigmented</span>
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="appearance" id="app_ulcer" value="Ulcer" class="checkbox-input">
                                    <label for="app_ulcer" class="checkbox-label">
                                        <span class="checkbox-box">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </span>
                                        <span class="checkbox-text">Ulcer</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Lesion Size -->
                        <div class="form-group">
                            <label class="form-label">What is the size of the lesion?</label>
                            <div class="options-group">
                                <div class="option-item">
                                    <input type="radio" name="lesion_size" id="size_large" value="Larger than 5mm" class="option-input" required>
                                    <label for="size_large" class="option-label">Larger than 5mm</label>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="lesion_size" id="size_small" value="Smaller than 5mm" class="option-input">
                                    <label for="size_small" class="option-label">Smaller than 5mm</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Get Diagnosis
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p class="footer-text">
                    Â© 2025 Skin Disease Expert System. For educational purposes only.
                </p>
            </div>
        </footer>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">Analyzing your symptoms...</p>
    </div>

    <script>
        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Mobile menu toggle
        const navToggle = document.getElementById('navToggle');
        const navLinks = document.getElementById('navLinks');
        
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('open');
        });

        // Form submission
        const diagnosisForm = document.getElementById('diagnosisForm');
        const loadingOverlay = document.getElementById('loadingOverlay');

        diagnosisForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validate at least one appearance is selected
            const appearances = document.querySelectorAll('input[name="appearance"]:checked');
            if (appearances.length === 0) {
                alert('Please select at least one lesion appearance option.');
                return;
            }

            // Collect form data
            const formData = new FormData(diagnosisForm);
            const answers = {};

            // Get single selections
            answers.age_group = formData.get('age_group');
            answers.allergy = formData.get('allergy');
            answers.itching = formData.get('itching');
            answers.burning_sensation = formData.get('burning_sensation');
            answers.pain = formData.get('pain');
            answers.lesion_size = formData.get('lesion_size');

            // Get multiple selections
            answers.appearance = formData.getAll('appearance');

            // Validate all required fields
            const requiredFields = ['age_group', 'allergy', 'itching', 'burning_sensation', 'pain', 'lesion_size'];
            for (const field of requiredFields) {
                if (!answers[field]) {
                    alert('Please complete all fields before submitting.');
                    return;
                }
            }

            // Show loading
            loadingOverlay.classList.add('active');

            try {
                const response = await fetch('/api/diagnose', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ answers })
                });

                const result = await response.json();

                // Store result and redirect to report
                sessionStorage.setItem('diagnosisResult', JSON.stringify(result));
                sessionStorage.setItem('userAnswers', JSON.stringify(answers));
                
                window.location.href = '/report';

            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
                loadingOverlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>
